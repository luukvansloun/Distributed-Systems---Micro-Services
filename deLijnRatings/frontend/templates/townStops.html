{% extends 'layout.html'%}  

{% block body %}
<h4 class="text-left"><strong>Stops</strong></h4>
  <div class="jumbotron text-center">
    <div class="row">
      <div class="col-md-8 col-md-offset-2">
        <div class="panel panel-login">
          <div class="panel-heading">
            <div class="row">
              <div class="col-xs-4">
                <a href="{{ url_for('rateStopLine') }}" class="active">Select Stop by Line</a>
              </div>
              <div class="col-xs-4">
                <a style="color: black;" href="{{ url_for('rateStopTown') }}">Select Stop by Town</a>
              </div>
              <div class="col-xs-4">
                <a href="{{ url_for('rateStopAll') }}">Select From All Stops</a>
              </div>
            </div>
              <hr>
            </div>
            <div class="panel-body">
              <form id="stopform" method="post" action="{{ url_for('rateStopAll') }}">
                {{ stop_rating_form.csrf_token }}
                {% from "_formhelpers.html" import render_field %}
                <div class="form-group">
                  {{render_field(stop_rating_form.town, class_="form-control")}}
                </div>
                <div id="stop_div">
                  <div class="form-group">
                    {{render_field(stop_rating_form.stop, class_="form-control")}}
                  </div>
                  <div class="form-group">
                    {{render_field(stop_rating_form.rating, class_="form-control")}}
                  </div>
                  <div class="form-group">
                    {{render_field(stop_rating_form.username, class_="form-control")}}
                  </div>
                  <div class="form-group">
                    {{render_field(stop_rating_form.password, class_="form-control")}}
                  </div>
                </div>
              </div>
                <p><input type="submit" class="btn btn-primary" style="background-color: grey; border:none;" value="Rate"></p>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let stop_div = document.getElementById('stop_div')

    let town_select = document.getElementById('townfield')
    let stop_select = document.getElementById('stopfield')

    window.onload = function() {
      town_select.innerHTML = '<option disabled selected>Select Town</option>' + town_select.innerHTML;
      stop_div.style.display = "none";
    }

    town_select.onchange = function () {
      town = town_select.value;

      fetch("http://localhost:5003/towns/" + town).then(function(response) {
        response.json().then(function(data) {
          let options = '<option disabled selected>Select Stop</option>';
          for(let stop of data.stops) {
            options += '<option value="' + stop.id + '">' + stop.id + ": " + stop.description + 
                  '</option>';
          }
          stop_select.innerHTML = options;
        });
        stop_div.style.display = "block";
      });
    }
  </script>

{% endblock %}